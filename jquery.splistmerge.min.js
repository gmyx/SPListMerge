(function(m){function n(c,g,e,d,h){var a,l;if("0"===c)return null;void 0===h&&(h={});for(a in d.fields)d.fields.hasOwnProperty(a)&&void 0!==e[g][c]&&(void 0!==d.fields[a].name?!1!==d.fields[a].output&&(h[d.fields[a].name]=e[g][c][d.fields[a]]):h[d.fields[a]]=e[g][c][d.fields[a]]);if(void 0!==d.join)for(l in d.join)d.join.hasOwnProperty(l)&&void 0!==e[g][c]&&(h=n(e[g][c][d.join[l].sourceField],l,e,d.join[l]));return h}m.merge=function(c,g){for(var e in g)g.hasOwnProperty(e)&&(c[e]=g[e]);return c}; m.join=function(c,g){for(var e in c)if(c.hasOwnProperty(e)&&void 0!==c[e][0])throw"Input format bad. Must be properly nammed map. See documentation for details.";var d,h,a,l;e={};var b,f;for(d in g)if(g.hasOwnProperty(d)){b={};for(h in c[d])if(c[d].hasOwnProperty(h)){b[h]={};for(a in g[d].fields)g[d].fields.hasOwnProperty(a)&&(f=g[d].fields[a],void 0!==f.name?!1!==f.output&&(b[h][f.name]=c[d][h][f.name]):b[h][f]=c[d][h][f]);if(void 0!==g[d].join)for(l in g[d].join)g[d].join.hasOwnProperty(l)&&(f= n(c[d][h][g[d].join[l].sourceField],l,c,g[d].join[l]),b[h]=m.merge(b[h],f))}void 0===e[d]&&(e[d]={});e[d]=b}return e}})(window.JSONJoin=window.JSONJoin||{},jQuery); (function(m){function n(a,d,b){return function(f){var c,g={},e={},j;for(j in a.fields)a.fields.hasOwnProperty(j)&&(void 0!==a.fields[j].name?(e.mappedName=a.fields[j].name,void 0!==a.fields[j].objectType?e.objectType=a.fields[j].objectType:delete e.objectType,g["ows_"+a.fields[j].name]={mappedName:e.mappedName,objectType:e.objectType}):(e.mappedName=a.fields[j],g["ows_"+j]={mappedName:e.mappedName}));c={mapping:g};var k,g={},e=[];j=[];var n=/.*;#(.*)/;f=$(f.responseXML).SPFilterNode("z:row").SPXmlToJson(c); for(k in a.fields)a.fields.hasOwnProperty(k)&&(!0===a.fields[k].asSourceField?e.push(k):!0===a.fields[k].complex&&j.push(k));for(k=0;k<f.length;k+=1){if(void 0!==e[0])for(c=0;c<e.length;c+=1)f[k][e[c]]=f[k][e[c]].lookupId;if(void 0!==j[0])for(c=0;c<j.length;c+=1)f[k][j[c]]=f[k][j[c]].match(n)[1];g[f[k][d]]=f[k]}h[b]=g}}function c(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()}function g(a,d){var b="<"+c(a.operator)+">",b=void 0!==a.alias?b+("<FieldRef Name='"+a.alias+"'></FieldRef>"): b+("<FieldRef Name='"+d+"'></FieldRef>"),b=void 0!==a.type?"String"===a.type?b+("<Value Type='"+a.type+"'>'"+a.value+"'"):b+("<Value Type='"+a.type+"'>"+a.value):!0===$.isNumeric(a.value)?b+("<Value Type='Integer'>"+a.value):b+("<Value Type='String'>'"+a.value+"'");return b=b+"</Value>"+("</"+c(a.operator)+">")}function e(a,d){var b="<"+c(d)+">",f;for(f in a)a.hasOwnProperty(f)&&(b="and"===f.toLowerCase()||"or"===f.toLowerCase()?b+e(a[f],f):b+g(a[f],f));return b+="</"+c(d)+">"}function d(a,c){var b, f,h,p,m="",j="",k,q=[];for(b in a)if(a.hasOwnProperty(b)){$().SPServices({operation:"GetList",listName:b,async:!1,completefunc:function(a){$(a.responseXML).find("Fields > Field").each(function(){if("Lookup"===$(this).attr("Type")||"Calculated"===$(this).attr("Type"))q[$(this).attr("StaticName")]=$(this).attr("StaticName")})}});for(h in a[b].fields)a[b].fields.hasOwnProperty(h)&&(j+="<FieldRef Name='"+h+"' />",void 0!==q[h]&&(a[b].fields[h]={name:h,complex:!0}));if(void 0!==a[b].join){for(f in a[b].join)a[b].join.hasOwnProperty(f)&& void 0===a[b].fields[a[b].join[f].sourceField]&&(a[b].fields[a[b].join[f].sourceField]={name:a[b].join[f].sourceField,objectType:"Lookup",output:!1,asSourceField:!0},j+="<FieldRef Name='"+a[b].join[f].sourceField+"' />");d(a[b].join,!1)}k=void 0!==a[b].targetField?a[b].targetField:"ID";void 0===a[b].fields[k]&&(a[b].fields[k]={name:k,output:!1},j+="<FieldRef Name='"+k+"' />");if(!0===c)if(void 0!==a[b].where){for(p in a[b].where)a[b].where.hasOwnProperty(p)&&(m="and"===p.toLowerCase()||"or"===p.toLowerCase()? m+e(a[b].where[p],p):g(a[b].where[p],p));$().SPServices({operation:"GetListItems",async:!1,listName:b,CAMLViewFields:"<ViewFields>"+j+"</ViewFields>",CAMLQuery:"<Query><Where>"+m+"</Where></Query>",completefunc:n(a[b],k,b)})}else $().SPServices({operation:"GetListItems",async:!1,listName:b,CAMLViewFields:"<ViewFields>"+j+"</ViewFields>",completefunc:n(a[b],k,b)});else $().SPServices({operation:"GetListItems",async:!1,listName:b,CAMLViewFields:"<ViewFields>"+j+"</ViewFields>",completefunc:n(a[b],k, b)})}}var h={};m.getLists=function(a,c){d(a,!0);c(JSONJoin.join(h,a))}})(window.SPListMerge=window.SPListMerge||{},jQuery);